namespace Workflow.GitHub
{
	using System;
	using System.IO;

	using JetBrains.Annotations;

	using Common.Extensions;
	using Infrastructure.Plugins.Agent.Contracts;
	using Repository.Context;

	[UsedImplicitly]
	internal sealed class VulnerabilityInfoProvider : IVulnerabilityInfoProvider
	{
		public VulnerabilityInfo[] GetByTask([NotNull] Tasks task)
		{
			if (task == null)
			{
				throw new ArgumentNullException(nameof(task));
			}

			if(string.IsNullOrWhiteSpace(task.ResultPath) || !File.Exists(task.ResultPath))
			{
				throw new ArgumentException("Result file is not found or not accessible");
			}

			var content = File.ReadAllText(task.ResultPath);

			return content.FromJson<VulnerabilityInfo[]>(false) ?? new VulnerabilityInfo[0];
		}
	}
}